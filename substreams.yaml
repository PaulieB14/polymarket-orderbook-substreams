specVersion: v0.1.0
package:
  name: polymarket_orderbook_substreams
  version: v0.2.0
  url: https://github.com/PaulieB14/polymarket-orderbook-substreams
  image: ./download.png
  doc: |
    # Polymarket Orderbook Substreams

    Real-time orderbook event extraction for Polymarket prediction markets on Polygon.

    Features:
    - Order fill extraction from CTF Exchange and Neg Risk Exchange
    - Orders matched event tracking
    - Combined order flow stream from both exchanges
    - Price calculation and trade side determination

    SQL schemas included for PostgreSQL and Clickhouse persistence.

network: polygon

protobuf:
  files:
    - polymarket/orderbook/v1/orderbook.proto
  importPaths:
    - ./proto

binaries:
  default:
    type: wasm/rust-v1
    file: ./target/wasm32-unknown-unknown/release/polymarket_orderbook_substreams.wasm

modules:
  # ============================================
  # Event Extraction Modules (Layer 1)
  # ============================================

  - name: map_ctf_exchange_order_filled
    kind: map
    initialBlock: 57000000
    inputs:
      - source: sf.ethereum.type.v2.Block
    output:
      type: proto:polymarket.orderbook.v1.OrderFilledEvents
    doc: |
      Extracts OrderFilled events from CTF Exchange (0x4bfb41d5b3570defd03c39a9a4d8de6bd8b8982e).
      Includes price calculation and trade side determination.

  - name: map_neg_risk_exchange_order_filled
    kind: map
    initialBlock: 57000000
    inputs:
      - source: sf.ethereum.type.v2.Block
    output:
      type: proto:polymarket.orderbook.v1.OrderFilledEvents
    doc: |
      Extracts OrderFilled events from Neg Risk Exchange (0xC5d563A36AE78145C45a50134d48A1215220f80a).
      Handles negative risk markets with specialized processing.

  - name: map_ctf_exchange_orders_matched
    kind: map
    initialBlock: 57000000
    inputs:
      - source: sf.ethereum.type.v2.Block
    output:
      type: proto:polymarket.orderbook.v1.OrdersMatchedEvents
    doc: Extracts OrdersMatched events from CTF Exchange.

  - name: map_neg_risk_exchange_orders_matched
    kind: map
    initialBlock: 57000000
    inputs:
      - source: sf.ethereum.type.v2.Block
    output:
      type: proto:polymarket.orderbook.v1.OrdersMatchedEvents
    doc: Extracts OrdersMatched events from Neg Risk Exchange.

  # ============================================
  # Combined Events Module (Layer 1.5)
  # ============================================

  - name: map_all_order_fills
    kind: map
    initialBlock: 57000000
    inputs:
      - map: map_ctf_exchange_order_filled
      - map: map_neg_risk_exchange_order_filled
    output:
      type: proto:polymarket.orderbook.v1.OrderFilledEvents
    doc: |
      Combines order fills from both exchanges into a single stream.
      Use this module for unified order flow analysis.
